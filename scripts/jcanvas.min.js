/*!
jCanvas v5.4
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(x,c,I,t,r,v,M,w,y){var z,O,E=x.extend,K=t.round,d=t.PI,m=t.sin,b=t.cos,j=x.event.fix,l={},C;function D(){}function L(P){if(P){E(O,P)}else{O=E(D.prototype,z)}return this}x.fn.jCanvas=L;L.version="5.4";L.events={};z={angle:0,align:"center",autosave:v,baseline:"middle",ccw:M,closed:M,compositing:"source-over",cornerRadius:0,cropFromCenter:v,each:w,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:v,height:w,inDegrees:v,load:w,mask:M,miterLimit:10,opacity:1,projection:0,r1:w,r2:w,radius:0,repeat:"repeat",rotate:0,rounded:M,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:w,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:w,sx:w,sy:w,text:"",translate:0,translateX:0,translateY:0,visible:v,width:w,x:0,y:0,};L();function G(P,Q){P.fillStyle=Q.fillStyle;P.strokeStyle=Q.strokeStyle;P.lineWidth=Q.strokeWidth;if(Q.rounded){P.lineCap="round";P.lineJoin="round"}else{P.lineCap=Q.strokeCap;P.lineJoin=Q.strokeJoin;P.miterLimit=Q.miterLimit}P.shadowOffsetX=Q.shadowX;P.shadowOffsetY=Q.shadowY;P.shadowBlur=Q.shadowBlur;P.shadowColor=Q.shadowColor;P.globalAlpha=Q.opacity;P.globalCompositeOperation=Q.compositing}function N(Q){var P=x.data(Q,"eventCache");if(!P){P=x.data(Q,"eventCache",{x:[],y:[]})}return P}function B(P){L.events[P]=function(Q){var R=(P==="mouseover"||P==="mouseout")?"mousemove":P;Q.bind(R+".jCanvas",function(T){var S=N(Q[0]);S.x[1]=S.x[0];S.y[1]=S.y[0];S.x[0]=T.offsetX;S.y[0]=T.offsetY;S.type=R;Q.drawLayers()});x.data(Q[0],"jCanvas-"+P,v)}}B("click");B("dblclick");B("mousedown");B("mouseup");B("mousemove");B("mouseover");B("mouseout");function e(P,Q){Q.mouseX=P.x[0];Q.mouseY=P.y[0]}function J(U,P,S){var R=x.data(U,"eventCache"),T,W,V,Q;T=R.type;W=S[T];V=P.isPointInPath(R.x[0],R.y[0]);Q=P.isPointInPath(R.x[1],R.y[1]);if(S.mouseover||S.mouseout){if(V&&!Q&&!S._fired){S._fired=v;e(R,S);if(S.mouseover){S.mouseover.call(U,S);G(P,S)}}else{if(!V&&Q&&S._fired){S._fired=M;e(R,S);if(S.mouseout){S.mouseout.call(U,S);G(P,S)}}}}if(W&&V){e(R,S);W.call(U,S);G(P,S)}}function s(P){return(P&&P.getContext?P.getContext("2d"):w)}function n(P,Q){if(Q.mask){if(Q.autosave){P.save()}P.clip()}if(Q.closed){P.closePath();P.fill();P.stroke()}else{P.fill();P.stroke();P.closePath()}}function q(P,Q){if((!Q.translateX&&!Q.translateY)&&(Q.x||Q.y)){Q.translateX=Q.x;Q.translateY=Q.y}if(Q.translate){Q.translateX=Q.translateY=Q.translate}P.translate(Q.translateX,Q.translateY)}function u(P,Q){if(Q.scale!==1){Q.scaleX=Q.scaleY=Q.scale}P.translate(Q.x,Q.y);P.scale(Q.scaleX,Q.scaleY);P.translate(-Q.x,-Q.y)}function o(P,Q){Q.toRad=(Q.inDegrees?d/180:1);Q.rotate=Q.rotate||Q.angle;P.translate(Q.x,Q.y);P.rotate(Q.rotate*Q.toRad);P.translate(-Q.x,-Q.y)}function g(S,Q,T,R,P){T.toRad=(T.inDegrees?d/180:1);Q.save();P=P||R;if(!S&&!T.fromCenter){T.x+=R/2;T.y+=P/2}if(T.rotate||T.angle){o(Q,T)}if(T.scale!==1||T.scaleX!==1||T.scaleY!==1){u(Q,T)}if(T.translate||T.translateX||T.translateY){q(Q,T)}}L.extend=function(P){z=E(z,P.props);L();if(P.name){x.fn[P.name]=function(R){var V=this,S,T,Q,U=E(new D(),R);for(T=0;T<V.length;T+=1){S=V[T];Q=s(S);if(Q){G(Q,U);P.fn.call(S,Q,U)}}return V}}return x.fn[P.name]};x.fn.loadCanvas=function(){return s(this[0])};x.fn.draw=function i(Q){var T=this,R,P,S;if(Q&&!Q.fn){Q={fn:Q}}S=E(new D(),Q);for(R=0;R<T.length;R+=1){P=s(T[R]);if(P){p(T[R],Q,i);Q.fn.call(T[R],P)}}return T};x.fn.gradient=function(X){var P=this,ab,U=E(new D(),X),Z,aa=[],W,R,T,V,Y,S,Q;ab=s(P[0]);if(ab){if(U.r1!==w||U.r2!==w){Z=ab.createRadialGradient(U.x1,U.y1,U.r1,U.x2,U.y2,U.r2)}else{Z=ab.createLinearGradient(U.x1,U.y1,U.x2,U.y2)}for(V=1;U["c"+V]!==y;V+=1){if(U["s"+V]!==y){aa.push(U["s"+V])}else{aa.push(w)}}W=aa.length;if(aa[0]===w){aa[0]=0}if(aa[W-1]===w){aa[W-1]=1}for(V=0;V<W;V+=1){if(aa[V]!==w){S=1;Q=0;R=aa[V];for(Y=(V+1);Y<W;Y+=1){if(aa[Y]!==w){T=aa[Y];break}else{S+=1}}if(R>T){aa[Y]=aa[V]}}else{if(aa[V]===w){Q+=1;aa[V]=R+(Q*((T-R)/S))}}Z.addColorStop(aa[V],U["c"+(V+1)])}}else{Z=w}return Z};x.fn.pattern=function(V){var P=this,X,R=E(new D(),V),S,U,W;function T(){U=X.createPattern(S,R.repeat)}function Q(){T();if(R.load){R.load.call(P[0],U)}}X=s(P[0]);if(X){if(typeof R.source==="function"){S=c.createElement("canvas");S.width=R.width;S.height=R.height;W=s(S);R.source.call(S,W);Q()}else{W=R.source.getContext;if(R.source.src||W){S=R.source}else{S=new I();S.src=R.source}if(S.complete||W){Q()}else{S.onload=Q}}}else{U=w}return U};x.fn.clearCanvas=function(Q){var T=this,R,P,S=E(new D(),Q);for(R=0;R<T.length;R+=1){P=s(T[R]);if(P){g(R,P,S,S.width,S.height);if(!S.x&&!S.y&&!S.width&&!S.height){P.clearRect(0,0,T[R].width,T[R].height)}else{P.clearRect(S.x-S.width/2,S.y-S.height/2,S.width,S.height)}}}return T};x.fn.saveCanvas=function(){var R=this,Q,P;for(Q=0;Q<R.length;Q+=1){P=s(R[Q]);if(P){P.save()}}return R};x.fn.restoreCanvas=function(){var R=this,Q,P;for(Q=0;Q<R.length;Q+=1){P=s(R[Q]);if(P){P.restore()}}return R};x.fn.scaleCanvas=function(Q){var T=this,R,P,S=E(new D(),Q);for(R=0;R<T.length;R+=1){P=s(T[R]);if(P){if(S.autosave){P.save()}u(P,S)}}return T};x.fn.translateCanvas=function(Q){var T=this,R,P,S=E(new D(),Q);for(R=0;R<T.length;R+=1){P=s(T[R]);if(P){if(S.autosave){P.save()}q(P,S)}}return T};x.fn.rotateCanvas=function(Q){var T=this,R,P,S=E(new D(),Q);for(R=0;R<T.length;R+=1){P=s(T[R]);if(P){if(S.autosave){P.save()}o(P,S)}}return T};x.fn.drawRect=function i(V){var Q=this,U,Y,T=E(new D(),V),S,X,R,W,P;for(U=0;U<Q.length;U+=1){Y=s(Q[U]);if(Y){p(Q[U],V,i);G(Y,T);g(U,Y,T,T.width,T.height);Y.beginPath();S=T.x-T.width/2;X=T.y-T.height/2;P=T.cornerRadius;if(P){T.closed=v;R=T.x+T.width/2;W=T.y+T.height/2;if((R-S)-(2*P)<0){P=(R-S)/2}if((W-X)-(2*P)<0){P=(W-X)/2}Y.moveTo(S+P,X);Y.lineTo(R-P,X);Y.arc(R-P,X+P,P,3*d/2,d*2,M);Y.lineTo(R,W-P);Y.arc(R-P,W-P,P,0,d/2,M);Y.lineTo(S+P,W);Y.arc(S+P,W-P,P,d/2,d,M);Y.lineTo(S,X+P);Y.arc(S+P,X+P,P,d,3*d/2,M)}else{Y.rect(S,X,T.width,T.height)}Y.restore();if(T._event){J(Q[U],Y,V)}n(Y,T)}}return Q};x.fn.drawArc=function i(Q){var T=this,R,P,S=E(new D(),Q);if(!S.inDegrees&&S.end===360){S.end=d*2}for(R=0;R<T.length;R+=1){P=s(T[R]);if(P){p(T[R],Q,i);G(P,S);g(R,P,S,S.radius*2);P.beginPath();P.arc(S.x,S.y,S.radius,(S.start*S.toRad)-(d/2),(S.end*S.toRad)-(d/2),S.ccw);P.restore();if(S._event){J(T[R],P,Q)}n(P,S)}}return T};x.fn.drawEllipse=function i(R){var V=this,T,Q,U=E(new D(),R),S=U.width*4/3,P=U.height;for(T=0;T<V.length;T+=1){Q=s(V[T]);if(Q){p(V[T],R,i);G(Q,U);g(T,Q,U,U.width,U.height);Q.beginPath();Q.moveTo(U.x,U.y-P/2);Q.bezierCurveTo(U.x-S/2,U.y-P/2,U.x-S/2,U.y+P/2,U.x,U.y+P/2);Q.bezierCurveTo(U.x+S/2,U.y+P/2,U.x+S/2,U.y-P/2,U.x,U.y-P/2);Q.restore();if(U._event){J(V[T],Q,R)}n(Q,U)}}return V};x.fn.drawPolygon=function i(U){var P=this,T,aa,R=E(new D(),U),Z=d/R.sides,Q=(d/2)+Z,Y=(d*2)/R.sides,X=b(Y/2)*R.radius,W,V,S;R.closed=v;for(T=0;T<P.length;T+=1){aa=s(P[T]);if(aa){p(P[T],U,i);G(aa,R);g(T,aa,R,R.radius*2);aa.beginPath();for(S=0;S<R.sides;S+=1){W=R.x+K(R.radius*b(Q));V=R.y+K(R.radius*m(Q));aa.lineTo(W,V);if(R.projection){W=R.x+K((X+X*R.projection)*b(Q+Z));V=R.y+K((X+X*R.projection)*m(Q+Z));aa.lineTo(W,V)}Q+=Y}aa.restore();if(R._event){J(P[T],aa,U)}n(aa,R)}}return P};x.fn.drawLine=function i(R){var W=this,U,Q,V=E(new D(),R),P,T,S;for(U=0;U<W.length;U+=1){Q=s(W[U]);if(Q){p(W[U],R,i);G(Q,V);P=1;Q.beginPath();while(v){T=V["x"+P];S=V["y"+P];if(T!==y&&S!==y){Q.lineTo(T,S);P+=1}else{break}}if(V._event){J(W[U],Q,R)}n(Q,V)}}return W};x.fn.drawQuad=function i(V){var P=this,U,Y,T=E(new D(),V),S,R,Q,X,W;for(U=0;U<P.length;U+=1){Y=s(P[U]);if(Y){p(P[U],V,i);G(Y,T);S=2;Y.beginPath();Y.moveTo(T.x1,T.y1);while(v){R=T["x"+S];Q=T["y"+S];X=T["cx"+(S-1)];W=T["cy"+(S-1)];if(R!==y&&Q!==y&&X!==y&&W!==y){Y.quadraticCurveTo(X,W,R,Q);S+=1}else{break}}if(T._event){J(P[U],Y,V)}n(Y,T)}}return P};x.fn.drawBezier=function i(aa){var P=this,Z,ab,W=E(new D(),aa),V,S,U,T,Y,R,X,Q;for(Z=0;Z<P.length;Z+=1){ab=s(P[Z]);if(ab){p(P[Z],aa,i);G(ab,W);V=2;S=1;ab.beginPath();ab.moveTo(W.x1,W.y1);while(v){U=W["x"+V];T=W["y"+V];Y=W["cx"+S];R=W["cy"+S];X=W["cx"+(S+1)];Q=W["cy"+(S+1)];if(U!==y&&T!==y&&Y!==y&&R!==y&&X!==y&&Q!==y){ab.bezierCurveTo(Y,R,X,Q,U,T);V+=1;S+=2}else{break}}if(W._event){J(P[Z],ab,aa)}n(ab,W)}}return P};function F(T,P,U){var Q,R,S=/\b(\d*\.?\d*)\w\w\b/gi;if(l.text===U.text&&l.font===U.font){U.width=l.width;U.height=l.height}else{U.width=P.measureText(U.text).width;Q=T.style.fontSize;R=U.font.match(S);if(R){T.style.fontSize=U.font.match(S)[0]}U.height=r(x.css(T,"fontSize"));T.style.fontSize=Q}}x.fn.drawText=function i(R){var U=this,Q,S,P,T=E(new D(),R);for(S=0;S<U.length;S+=1){Q=x(U[S]);P=s(Q[0]);if(P){p(U[S],R,i);G(P,T);P.textBaseline=T.baseline;P.textAlign=T.align;P.font=T.font;F(Q[0],P,T);g(S,P,T,T.width,T.height);P.strokeText(T.text,T.x,T.y);P.fillText(T.text,T.x,T.y);if(T._event){P.beginPath();P.rect(T.x-T.width/2,T.y-T.height/2,T.width,T.height);P.restore();J(U[S],P,R);P.closePath()}else{P.restore()}}}l=T;return U};x.fn.drawImage=function i(W){var P=this,R,V,Y,T=E(new D(),W),U,Q;if(T.source.src){U=T.source}else{if(T.source){U=new I();U.src=T.source}}function X(aa,Z){if(!aa){Q=U.width/U.height;if(T.width===w&&T.sWidth===w){W.width=T.width=T.sWidth=U.width}if(T.height===w&&T.sHeight===w){W.height=T.height=T.sHeight=U.height}if(T.width===w&&T.sWidth!==w){T.width=T.sWidth}if(T.height===w&&T.sHeight!==w){T.height=T.sHeight}if(T.sWidth===w&&T.width!==w){W.sWidth=T.sWidth=U.width}if(T.sHeight===w&&T.height!==w){W.sHeight=T.sHeight=U.height}if(T.sx===w){if(T.cropFromCenter){T.sx=U.width/2}else{T.sx=0}}if(T.sy===w){if(T.cropFromCenter){T.sy=U.height/2}else{T.sy=0}}if(!T.cropFromCenter){T.sx+=T.sWidth/2;T.sy+=T.sHeight/2}if((T.sx+T.sWidth/2)>U.width){T.sx=U.width-T.sWidth/2}if((T.sx-T.sWidth/2)<0){T.sx=T.sWidth/2}if((T.sy-T.sHeight/2)<0){T.sy=T.sHeight/2}if((T.sy+T.sHeight/2)>U.height){T.sy=U.height-T.sHeight/2}if(T.width!==w&&T.height===w){W.height=T.height=T.width/Q}else{if(T.width===w&&T.height!==w){W.width=T.width=T.height*Q}else{if(T.width===w&&T.height===w){W.width=T.width=U.width;W.height=T.height=U.height}}}}Z.drawImage(U,T.sx-T.sWidth/2,T.sy-T.sHeight/2,T.sWidth,T.sHeight,T.x-T.width/2,T.y-T.height/2,T.width,T.height);if(T._event){Z.beginPath();Z.rect(T.x-T.width/2,T.y-T.height/2,T.width,T.height);Z.restore();J(P[aa],Z,W);Z.closePath()}else{Z.restore()}}function S(aa,ab,Z){return function(){X(ab,Z);if(T.load){T.load.call(aa,W)}}}for(V=0;V<P.length;V+=1){R=P[V];Y=s(P[V]);if(Y){p(P[V],W,i);G(Y,T);g(V,Y,T,T.width,T.height);if(U){if(U.complete){S(R,V,Y)()}else{U.onload=S(R,V,Y)}}}}return P};x.fn.getCanvasImage=function(P,R){var Q=this[0];return(Q&&Q.toDataURL)?Q.toDataURL("image/"+P,R):w};x.fn.setPixels=function i(X){var P=this,R,W,Z,S=E(new D(),X),Y={},Q,U,T,V;for(W=0;W<P.length;W+=1){R=P[W];Z=s(R);if(Z){p(P[W],X,i);g(W,Z,S,S.width,S.height);if(!S.x&&!S.y&&!S.width&&!S.height){S.width=R.width;S.height=R.height;S.x=S.width/2;S.y=S.height/2}Q=Z.getImageData(S.x-S.width/2,S.y-S.height/2,S.width,S.height);U=Q.data;V=U.length;Y=[];if(S.each!==w){for(T=0;T<V;T+=4){Y.r=U[T];Y.g=U[T+1];Y.b=U[T+2];Y.a=U[T+3];S.each.call(R,Y);U[T]=Y.r;U[T+1]=Y.g;U[T+2]=Y.b;U[T+3]=Y.a}}Z.putImageData(Q,S.x-S.width/2,S.y-S.height/2);Z.restore()}}return P};x.fn.getLayers=function(){var P=this[0],Q;if(!P||!P.getContext){Q=[]}else{Q=x.data(P,"jCanvas-layers");if(!Q){Q=[];x.data(P,"jCanvas-layers",Q)}}return Q};x.fn.getLayer=function(P){var R=this.getLayers(),Q;if(typeof P==="string"){for(Q=0;Q<R.length;Q+=1){R[Q].index=Q;if(R[Q].name===P){P=Q;break}}}P=P||0;return R[P]};x.fn.getLayerGroup=function(P){var S=this.getLayers(),R=[],Q;for(Q=0;Q<S.length;Q+=1){if(S[Q].group===P){R.push(S[Q])}}return R};function a(Q,P,R){if(R&&R.visible){if(R.method===x.fn.draw){R.fn.call(Q[0],P)}else{if(R.method){R.method.call(Q,R)}}}}x.fn.drawLayer=function(R){var U=this,T,P,Q,S;for(T=0;T<U.length;T+=1){Q=x(U[T]);P=s(Q[0]);if(R.layer){a(Q,P,R)}else{S=Q.getLayer(R)}a(Q,P,S)}};x.fn.drawLayers=function(){var V=this,Q,U,P,T,S,R;for(U=0;U<V.length;U+=1){Q=x(V[U]);P=s(Q[0]);if(P){P.clearRect(0,0,Q[0].width,Q[0].height);T=Q.getLayers();for(R=0;R<T.length;R+=1){S=T[R];a(Q,P,S)}}}return V};function p(T,R,W){var Q,V,S,U,P=(typeof R==="function");R=R||{};if(R.layer&&!R._layer){Q=x(T);V=Q.getLayers();if(P){U=R;R={method:x.fn.draw,fn:U,name:U.name,group:U.group,visible:U.visible}}R=E(new D(),R);if(!P){R.method=x.fn[R.method]||W;if(R.method!==x.fn.drawImage){R.width=R.width||0;R.height=R.height||0}for(S in L.events){if(L.events.hasOwnProperty(S)&&R[S]){if(!x.data(Q[0],"jCanvas-"+S)){L.events[S].call(x,Q)}R._event=v}}}R.layer=v;R._layer=v;if(R.index===y){R.index=V.length}V.splice(R.index,0,R)}}x.fn.addLayer=function(Q){var S=this,R,P;Q=Q||{};for(R=0;R<S.length;R+=1){P=s(S[R]);if(P){Q.layer=v;p(S[R],Q)}}return S};x.fn.removeLayers=function(){var R=this,Q,P;for(P=0;P<R.length;P+=1){Q=x(R[P]).getLayers();Q.length=0}return R};x.fn.removeLayer=function(P){var T=this,S,R,Q;for(S=0;S<T.length;S+=1){R=x(T[S]).getLayers();if(typeof P==="string"){for(Q=0;Q<R.length;Q+=1){if(R[Q].name===P){P=Q;break}}}R.splice(P,1)}return T};C=["width","height","opacity"];function f(Q){var P;for(P=0;P<C.length;P+=1){Q[C[P]]=Q["_"+C[P]]}}function h(Q){var P;for(P=0;P<C.length;P+=1){Q["_"+C[P]]=Q[C[P]]}}function A(Q){var T,S,R=[],P=1;if(Q.match(/^#?[a-z0-9]+$/i)){S=c.head;T=S.style.color;S.style.color=Q;Q=x.css(S,"color");S.style.color=T}if(Q.match(/^rgb/i)){R=Q.match(/[0-9]+/gi);if(Q.match(/%/gi)){P=2.55}R[0]=R[0]*P;R[1]=R[1]*P;R[2]=R[2]*P}return R}function H(Q){var P;if(typeof Q.start!=="object"){Q.start=A(Q.start);Q.end=A(Q.end)}Q.now=[];for(P=0;P<3;P+=1){Q.now[P]=K(Q.start[P]+(Q.end[P]-Q.start[P])*Q.pos)}Q.now="rgb("+Q.now.join(",")+")";if(Q.elem.style){Q.elem.style[Q.prop]=Q.now}else{Q.elem[Q.prop]=Q.now}}x.fn.animateLayer=function(){var P=this,Q,V,X,W=([]).slice.call(arguments,0),T,U;if(typeof W[0]==="object"&&!W[0].layer){W.unshift(0)}if(W[2]===y){W.splice(2,0,w);W.splice(3,0,w);W.splice(4,0,w)}else{if(typeof W[2]==="function"){W.splice(2,0,w);W.splice(3,0,w)}}if(W[3]===y){W[3]=w;W.splice(4,0,w)}else{if(typeof W[3]==="function"){W.splice(3,0,w)}}if(W[4]===y){W[4]=w}function R(Y,Z){return function(){f(Z);Y.drawLayers();if(W[4]){W[4].call(Y)}}}function S(Y,Z){return function(){f(Z);Y.drawLayers()}}for(V=0;V<P.length;V+=1){Q=x(P[V]);X=s(P[V]);if(X){if(W[0].layer){T=W[0]}else{T=Q.getLayer(W[0])}if(T&&T.method!==x.fn.draw){h(T);h(W[1]);U=N(P[V]);U.x=[];U.y=[];x(T).animate(W[1],{duration:W[2],easing:(x.easing[W[3]]?W[3]:w),complete:R(Q,T),step:S(Q,T)})}}}return P};x.fn.stopLayer=function(P,Q){if(!P.layer){P=x(this).getLayer(P)}x(P).stop(Q);return this};x.event.fix=function(P){var Q;P=j.call(x.event,P);if(P.pageX!==y&&P.offsetX===y){Q=x(P.target).offset();if(Q){P.offsetX=P.pageX-Q.left;P.offsetY=P.pageY-Q.top}}return P};function k(P){var Q;for(Q=0;Q<P.length;Q+=1){x.fx.step[P[Q]]=H}}k(["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","outlineColor","strokeStyle","shadowColor",]);x.support.canvas=(c.createElement("canvas").getContext!==y);L.defaults=z;L.prefs=O;x.jCanvas=L}(jQuery,document,Image,Math,parseFloat,true,false,null));